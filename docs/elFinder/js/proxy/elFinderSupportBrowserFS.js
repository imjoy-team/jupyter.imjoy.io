!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){let n=location.pathname;if(n.endsWith(".html")){const e=n.split("/");n=e.slice(0,e.length-1).join("/")+"/"}window.initializeServiceWorker=function(){"serviceWorker"in navigator?navigator.serviceWorker.controller?console.log("Service worker was activated."):(navigator.serviceWorker.oncontrollerchange=function(){this.controller.onstatechange=function(){"activated"===this.state&&console.log("Service worker successfully activated.")}},navigator.serviceWorker.register("/service-worker.js").then((function(e){console.log("Service worker successfully registered, scope is:",e.scope)})).catch((function(e){console.error("Service worker registration failed, error:",e)}))):console.log("Service workers are not supported.")},window.setupImJoyApp=function(){const e=document.createElement("div");document.getElementById("window-manager").appendChild(e);const t=window.define;window.define=void 0,loadImJoyBasicApp({version:"0.13.70",process_url_query:!0,show_window_title:!1,show_progress_bar:!0,show_empty_window:!0,window_manager_container:"window-manager",menu_style:{position:"absolute",right:0,top:"2px"},window_style:{width:"100%",height:"100%"},main_container:e,imjoy_api:{}}).then(async e=>{const t=e.imjoy.api,n={id:"elfinder-window",window_id:"elfinder-window-container",name:"elFinder",fullscreen:!0};function i(e){return new Promise(async(t,n)=>{const i=await fetch(e),r=await i.blob(),o=new FileReader;o.onload=function(){t(this.result)},o.onerror=n,o.readAsDataURL(r)})}e.allWindows.push(n),e.addWindow(n),e.$forceUpdate(),setTimeout(()=>{document.getElementById(n.window_id).appendChild(document.getElementById("elfinder"))},0),await t.registerService({type:"#file-loader",name:"ITK/VTK Viewer",async check(e){if(e.mime.startsWith("image/tiff"))return!0},async load({url:e,window_id:n}){console.log("https://kitware.github.io/itk-vtk-viewer/app/?fileToLoad="+e),await t.createWindow({src:"https://kitware.github.io/itk-vtk-viewer/app/?fileToLoad="+e,window_id:n})}}),await t.registerService({type:"#file-loader",name:"Kaibu",icon:"https://kaibu.org/static/img/kaibu-icon.svg",async check(e){if(e.mime.startsWith("image/")||"directory"===e.mime)return!0},async load({source:e,type:n,window_id:r}){if("file"===n){const n=await i(e.url),o=await t.createWindow({src:"https://kaibu.org/",window_id:r,w:10,h:10});await o.view_image(n,{name:e.name}),await o.add_shapes([],{name:"annotation"})}else if("directory"===n){const n=await t.createWindow({src:"https://kaibu.org/",window_id:r,w:10,h:10}),o=(e=e.filter(e=>e.mime.startsWith("image/"))).map(e=>({title:e.name,data:e,isLeaf:!0}));await n.add_widget({_rintf:!0,type:"tree",name:"Files",node_dbclick_callback:async e=>{await n.clear_layers();const t=e.data,r=await i(t.url);await n.view_image(r,{name:t.name})},nodes:o}),await n.add_shapes([],{name:"annotation"})}}}),await t.registerService({type:"#content-provider",name:"MyData",get:e=>({name:"My Folder",path:"/user",type:"directory",created:"2021-01-23T18:25:43.511Z",last_modified:"2021-01-23T18:25:43.511Z",mimetype:null,format:"json",content:[{name:"My SubFolder",path:"/user/me",type:"directory",created:"2021-01-23T18:25:43.511Z",last_modified:"2021-01-23T18:25:43.511Z",mimetype:null}]}),save(e,t){},delete_file(e){},rename_file(e,t){},file_exists(e){},dir_exists(e){},is_hidden(e){}}),window.imjoy=e.imjoy}).finally(()=>{window.define=t})};window.elFinderSupportBrowserFs=function(e){"use strict";this.parseFiles=function(e,t,n){const i=$.Deferred();return n.done((function(n){const r=n[0].length;let o=-1;if(r){if(n[4]&&n[4].length)return void e.request({data:{cmd:"mkdir",target:t,dirs:n[4]},notify:{type:"mkdir",cnt:n[4].length},preventFail:!0}).fail((function(e){"errCmdParams"===(e=e||["errUnknown"])[0]?o=1:(o=0,i.reject(e))})).done((function(e){var i=!1;e.hashes||(e.hashes={}),n[1]=$.map(n[1],(function(r,o){return n[0][o]._relativePath=r.replace(/^\//,""),""===(r=r.replace(/\/[^\/]*$/,""))?t:e.hashes[r]?e.hashes[r]:(i=!0,n[0][o]._remove=!0,null)})),i&&(n[0]=$.grep(n[0],(function(e){return!e._remove})))})).always((function(e){i.resolve(n)}));n[1]=$.map(n[1],(function(){return t})),i.resolve(n)}else i.reject(["errUploadNoFiles"])})).fail((function(){i.reject()})),i},this.upload=function(e){const t=this.fm,n=$.Deferred(),i=e.target||t.cwd().hash,r=e.input?e.input.files:t.uploads.checkFile(e,t,i);function o(e){elfinder_api.upload(e).then(e=>{t.uploads.xhrUploading=!1,e&&(t.currentReqCmd="upload",e.warning&&console.warn(e.warning),t.updateCache(e),e.removed&&e.removed.length&&t.remove(e),e.added&&e.added.length&&t.add(e),e.changed&&e.changed.length&&t.change(e),t.trigger("upload",e,!1),t.trigger("uploaddone"),e.toasts&&Array.isArray(e.toasts)&&$.each(e.toasts,(function(){this.msg&&t.toast(this)})),e.sync&&t.sync(),e.debug&&(t.responseDebug(e),fm.debug("backend-debug",e))),n.resolve(e)}).catch(e=>{console.error(e),n.reject(e)})}return e.progress=e=>{t.notify({type:"upload",cnt:0,progress:e,size:0})},r.done?this.parseFiles(t,i,r).done(e=>{o({files:e[0],targets:e[1],renames:e[2],hashes:e[3]})}):o({targets:r.map(()=>i),files:r}),n},this.init=function(e){this.fm=e,this.fm.options.url=n+"/fs/connector"},this.send=function(e){const t=$.Deferred();t.abort=function(){};const n=function(e){e=new URLSearchParams(e);const t={};for(let n of Array.from(e.entries()))t[n[0]]?Array.isArray(t[n[0]])?t[n[0]].push(n[1]):t[n[0]]=[t[n[0]],n[1]]:n[0].endsWith("[]")?t[n[0]]=[n[1]]:t[n[0]]=n[1];return t}(e.url.split("?")[1]);n&&Object.assign(e.data,n);const i=$.ajax(e).fail((function(e){t.reject(e)})).done((function(e){t.resolve(e)}));return t.abort=function(){i&&"pending"==i.state()&&(i.quiet=!0,i.abort())},t}}}]);
//# sourceMappingURL=elFinderSupportBrowserFS.js.map